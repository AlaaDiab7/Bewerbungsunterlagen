<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mein Portfolio</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <!-- Left-side: Certificate List -->
        <div class="content">
            <header>
                <h1>Willkommen in meinem Portfolio</h1>
                <p>Hier finden Sie meine Zertifikate und weitere Bewerbungsunterlagen.</p>
            </header>
            <main>
                <section id="certificates">
                    <h2>Zertifikate</h2>
                    <ul id="certificate-list">
                        <li><a href="#" onclick="selectCertificate('https://alaadiab7.github.io/Bewerbungsunterlagen/certificates/Zeugnisse_Alaa_Diab.pdf')">Uni Zeugnisse</a></li>
                        <li><a href="#" onclick="selectCertificate('https://alaadiab7.github.io/Bewerbungsunterlagen/certificates/Programming_certificates.pdf')">Programmier-Zertifikate</a></li>
                        <li><a href="#" onclick="selectCertificate('https://alaadiab7.github.io/Bewerbungsunterlagen/certificates/Zeugnisse_Alaa_Diab.pdf')">Simulation Zertifikate</a></li>
                    </ul>
                </section>

                <section id="recommendations">
                    <h2>Empfehlungen</h2>
                    <ul id="recommendation-list">
                        <li><a href="#" onmouseover="previewCertificate('rec1.pdf')">Empfehlungsschreiben 1</a></li>
                        <li><a href="#" onmouseover="previewCertificate('rec2.pdf')">Empfehlungsschreiben 2</a></li>
                    </ul>
                </section>

                <section id="publications">
                    <h2>Publikationen und Forschungen</h2>
                    <ul id="publication-list">
                        <li><a href="#" onmouseover="previewCertificate('pub1.pdf')">Publikation 1</a></li>
                        <li><a href="#" onmouseover="previewCertificate('pub2.pdf')">Publikation 2</a></li>
                    </ul>
                </section>
                
            </main>
        </div>
        <!-- Right-side: PDF Viewer -->
        <div class="preview">
            <div class="canvas-wrapper" id="canvas-wrapper">
                <canvas id="pdf-canvas"></canvas>
            </div>
            <div class="controls">
                <button onclick="saveFullPDF()">Zertifikat unterladen</button>
                <button onclick="prevPage()">Zur√ºck</button>
                <span id="page-info">Seite 1 von 10</span>
                <button onclick="nextPage()">Weiter</button>
                <button onclick="zoomIn()">Zoom In</button>
                <button onclick="zoomOut()">Zoom Out</button>
            </div>
        </div>
    </div>

<script type="module">
    import * as pdfjsLib from './build/pdf.mjs';
    pdfjsLib.GlobalWorkerOptions.workerSrc = './build/pdf.worker.mjs';

    let pdfDoc = null;
    let pdfData = null; // Global variable to store the raw PDF data
    let pageNum = 1;
    let scale = 1.5; // Default zoom scale
    const canvas = document.getElementById("pdf-canvas");
    const ctx = canvas.getContext("2d");

    async function loadPDF(url) {
        try {
            console.log("Fetching PDF from URL:", url);
            const response = await fetch(url);

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            pdfData = await response.arrayBuffer(); // Save the binary data
            console.log("PDF data loaded successfully:", pdfData.byteLength, "bytes");

            pdfDoc = await pdfjsLib.getDocument(pdfData).promise;

            pageNum = 1;
            renderPage(pageNum);
        } catch (error) {
            console.error("Error loading PDF:", error);
        }
    }

    async function renderPage(num) {
        const page = await pdfDoc.getPage(num);
        const viewport = page.getViewport({ scale });

        canvas.width = viewport.width;
        canvas.height = viewport.height;

        const renderContext = {
            canvasContext: ctx,
            viewport: viewport
        };
        await page.render(renderContext).promise;
        document.getElementById("page-info").textContent = `Seite ${pageNum} von ${pdfDoc.numPages}`;
    }

    function saveFullPDF() {
        if (!pdfData) {
            alert("No PDF loaded to save.");
            return;
        }
    
        try {
            // Ensure the data is not empty
            console.log("PDF data size:", pdfData.byteLength, "bytes");
    
            // Convert the array buffer to a Blob
            const blob = new Blob([new Uint8Array(pdfData)], { type: "application/pdf" });
    
            // Create a download link
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = "downloaded_certificate.pdf"; // File name for the saved file
            document.body.appendChild(link);
    
            // Trigger download
            link.click();
    
            // Clean up the link
            document.body.removeChild(link);
    
            console.log("PDF successfully downloaded.");
        } catch (error) {
            console.error("Error while saving PDF:", error);
        }
    }

    

    function prevPage() {
        if (pageNum <= 1) return;
        pageNum--;
        renderPage(pageNum);
    }

    function nextPage() {
        if (pageNum >= pdfDoc.numPages) return;
        pageNum++;
        renderPage(pageNum);
    }

    function zoomIn() {
        scale += 0.25;
        renderPage(pageNum);
    }

    function zoomOut() {
        if (scale > 0.5) {
            scale -= 0.25;
            renderPage(pageNum);
        }
    }

    function selectCertificate(url) {
        loadPDF(url);
    }

    window.prevPage = prevPage;
    window.nextPage = nextPage;
    window.zoomIn = zoomIn;
    window.zoomOut = zoomOut;
    window.saveFullPDF = saveFullPDF;
    window.selectCertificate = selectCertificate;
</script>

</body>
</html>
