<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mein Portfolio</title>
    <link rel="stylesheet" href="style.css">
   
</head>
<body>
    <div class="container">
        <!-- Left-side: Certificate List -->
        <div class="content">
            <header>
                <h1>Willkommen in meinem Portfolio</h1>
                <p>Hier finden Sie meine Zertifikate und weitere Bewerbungsunterlagen.</p>
            </header>
            <main>
                <section id="certificates">
                    <h2>Zertifikate</h2>
                    <ul id="certificate-list">
                        <li><a href="#" onclick="selectCertificate('https://alaadiab7.github.io/Bewerbungsunterlagen/certificates/Zeugnisse_Alaa_Diab.pdf')">Uni Zeugnisse</a></li>
                        <li><a href="#" onclick="selectCertificate('https://alaadiab7.github.io/Bewerbungsunterlagen/certificates/Zeugnisse_Alaa_Diab.pdf')">Programmier-Zertifikate</a></li>
                        <li><a href="#" onclick="selectCertificate('https://alaadiab7.github.io/Bewerbungsunterlagen/certificates/Zeugnisse_Alaa_Diab.pdf')">Simulation Zertifikate</a></li>
                    </ul>
                </section>

                
            <section id="recommendations">
                <h2>Empfehlungen</h2>
                <ul id="recommendation-list">
                    <li><a href="#" onmouseover="selectCertificate('rec1.pdf')">Empfehlungsschreiben 1</a></li>
                    <li><a href="#" onmouseover="selectCertificate('rec2.pdf')">Empfehlungsschreiben 2</a></li>
                </ul>
            </section>

            <section id="publications">
                <h2>Publikationen und Forschungen</h2>
                <ul id="publication-list">
                    <li><a href="#" onmouseover="selectCertificate('pub1.pdf')">Publikation 1</a></li>
                    <li><a href="#" onmouseover="selectCertificate('pub2.pdf')">Publikation 2</a></li>
                </ul>
            </section>
                
            </main>
        </div>
        <!-- Right-side: PDF Viewer -->
        <div class="preview">
            <div class="canvas-wrapper" id="canvas-wrapper">
                <canvas id="pdf-canvas"></canvas>
            </div>
            <div class="controls">
                <button onclick="saveFullPDF()">Zertifikat unterladen</button>
                <button onclick="prevPage()">Zur√ºck</button>
                <span id="page-info">Seite 1 von 10</span>
                <button onclick="nextPage()">Weiter</button>
                <button onclick="zoomIn()">Zoom In</button>
                <button onclick="zoomOut()">Zoom Out</button>
            </div>
        </div>

        
    </div>

<script type="module">
    import * as pdfjsLib from './build/pdf.mjs';
const pdfjsLib = window["./build/pdf"];
    pdfjsLib.GlobalWorkerOptions.workerSrc = './build/pdf.worker.mjs';

let pdfDoc = null;
let pdfData = null; // Global variable to store the raw PDF data
let pageNum = 1;
let scale = 1.5; // Default zoom scale
const canvas = document.getElementById("pdf-canvas");
const ctx = canvas.getContext("2d");
const canvasWrapper = document.getElementById("canvas-wrapper");

let isDragging = false; // Track drag state
let startX, startY; // Track mouse starting position
let translateX = 0, translateY = 0; // Track canvas position


    
// Load and render the PDF
/* async function loadPdf(url) {
    const pdf = await pdfjsLib.getDocument(url).promise;
    pdfDoc = pdf;
    renderPage(pageNum);
} */

// Load the pdf into the review using the url of the file 
async function loadPDF(url) {
    try {
        console.log("Fetching PDF from URL:", url); // Debugging
        const response = await fetch(url);
        
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }

        pdfData = await response.arrayBuffer(); // Save the binary data
        console.log("PDF data loaded successfully:", pdfData);

        // Load the PDF document
        pdfDoc = await pdfjsLib.getDocument(pdfData).promise;

        // Render the first page
        pageNum = 1;
        renderPage(pageNum);
    } catch (error) {
        console.error("Error loading PDF:", error);
    }
}


    

// Render a page with the current scale
async function renderPage(num) {
    const page = await pdfDoc.getPage(num);
    const viewport = page.getViewport({ scale });

    // Resize the canvas to match the viewport
    canvas.width = viewport.width;
    canvas.height = viewport.height;

    const renderContext = {
        canvasContext: ctx,
        viewport: viewport
    };
    await page.render(renderContext).promise;

    // Center the canvas in the container
    translateX = 0;
    translateY = 0;
    updateCanvasTransform();

    // Update page info
    document.getElementById("page-info").textContent = `Seite ${pageNum} von ${pdfDoc.numPages}`;
}

// Navigate to the previous page
function prevPage() {
    if (pageNum <= 1) return;
    pageNum--;
    renderPage(pageNum);
}

// Save the associated certificate as pdf
function saveFullPDF() {
    if (!pdfData) {
        alert("No PDF loaded to save.");
        return;
    }

    // Create a Blob from the PDF data and download it
    const blob = new Blob([pdfData], { type: "application/pdf" });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "certificate.pdf"; // Default name for the downloaded file
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}


    
// Navigate to the next page
function nextPage() {
    if (pageNum >= pdfDoc.numPages) return;
    pageNum++;
    renderPage(pageNum);
}

// Zoom in by increasing the scale
function zoomIn() {
    scale += 0.25; // Increase the scale factor
    renderPage(pageNum); // Re-render the current page
}

// Zoom out by decreasing the scale
function zoomOut() {
    if (scale > 0.5) {
        scale -= 0.25; // Decrease the scale factor
        renderPage(pageNum); // Re-render the current page
    }
}

// Update the canvas transform for zoom and drag
function updateCanvasTransform() {
    canvas.style.transform = `translate(${translateX}px, ${translateY}px) scale(${scale})`;
}

// Handle drag start
canvasWrapper.addEventListener("mousedown", (e) => {
    isDragging = true;
    startX = e.clientX - translateX;
    startY = e.clientY - translateY;
    canvasWrapper.style.cursor = "grabbing";
});

// Handle drag move
canvasWrapper.addEventListener("mousemove", (e) => {
    if (isDragging) {
        translateX = e.clientX - startX;
        translateY = e.clientY - startY;
        updateCanvasTransform();
    }
});

// Handle drag end
canvasWrapper.addEventListener("mouseup", () => {
    isDragging = false;
    canvasWrapper.style.cursor = "grab";
});

// Prevent drag state from persisting if the mouse leaves the wrapper
canvasWrapper.addEventListener("mouseleave", () => {
    isDragging = false;
    canvasWrapper.style.cursor = "grab";
});

/* Select the certificate when the user clicks on one certificate, 
to be able to be saved later if required*/
function selectCertificate(url) {
    loadPDF(url); // Load the selected certificate's PDF
}

    // Expose functions globally
    // window.loadPdf = loadPdf;
    window.prevPage = prevPage;
    window.nextPage = nextPage;
    window.zoomIn = zoomIn;
    window.zoomOut = zoomOut;
    window.saveFullPDF = saveFullPDF;
    window.selectCertificate = selectCertificate;
     
</script>
    
</body>
</html>
